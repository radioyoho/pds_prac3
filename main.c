/*
 * main.c
 *
 *  Created on: Mar 20, 2018
 *      Author: kanta
 */

#include <stdio.h>
#include <math.h>
#include "DAC.h"
#include "FLEX.h"
#include "GPIO.h"
#include "DataTypeDefinitions.h"

#define M_PI 3.14159265358979323846

static float t;

float chord_e_func();
float chord_g_func();
float chord_d_func();
float chord_a_func();
float chord_c_func();
float chord_f_func();



int main()
{

	FLEX_init();
	DAC0_clockGating();
	DAC0_enable();
	int counter;
	int chord_number;
	float sin_val;

	float chord_e, chord_g, chord_d, chord_a, chord_c, chord_f;
	const float env [1000] = {0,0.0040258435,0.0080516869,0.012077531,0.016103374,0.020129217,0.024155062,0.028180905,0.032206748,0.036232591,0.040258434,0.044284280,0.048310123,0.052335966,0.056361809,0.060387652,0.064413495,0.068439342,0.072465181,0.076491028,0.080516867,0.084542714,0.088568561,0.092594400,0.096620247,0.10064609,0.10467193,0.10869777,0.11272362,0.11674946,0.12077530,0.12480115,0.12882699,0.13285284,0.13687868,0.14090452,0.14493036,0.14895621,0.15298206,0.15700790,0.16103373,0.16505958,0.16908543,0.17311127,0.17713712,0.18116295,0.18518880,0.18921465,0.19324049,0.19726633,0.20129217,0.20531802,0.20934387,0.21336971,0.21739554,0.22142139,0.22544724,0.22947308,0.23349892,0.23752476,0.24155061,0.24557646,0.24960230,0.25362813,0.25765398,0.26167983,0.26570567,0.26973152,0.27375737,0.27778322,0.28180903,0.28583488,0.28986073,0.29388657,0.29791242,0.30193827,0.30596411,0.30998996,0.31401581,0.31804162,0.32206747,0.32609332,0.33011916,0.33414501,0.33817086,0.34219670,0.34622255,0.35024840,0.35427424,0.35830006,0.36232591,0.36635175,0.37037760,0.37440345,0.37842929,0.38245514,0.38648099,0.39050683,0.39453265,0.39855850,0.40258434,0.40661019,0.41063604,0.41466188,0.41868773,0.42271358,0.42673942,0.43076524,0.43479109,0.43881693,0.44284278,0.44686863,0.45089447,0.45492032,0.45894617,0.46297202,0.46699783,0.47102368,0.47504953,0.47907537,0.48310122,0.48712707,0.49115291,0.49517876,0.49920461,0.50323045,0.50725627,0.51128215,0.51530796,0.51933384,0.52335966,0.52738547,0.53141135,0.53543717,0.53946304,0.54348886,0.54751474,0.55154055,0.55556643,0.55959225,0.56048375,0.56003201,0.55958021,0.55912846,0.55867666,0.55822492,0.55777311,0.55732137,0.55686957,0.55641782,0.55596602,0.55551428,0.55506247,0.55461073,0.55415893,0.55370718,0.55325538,0.55280364,0.55235183,0.55190009,0.55144829,0.55099654,0.55054474,0.55009300,0.54964119,0.54918945,0.54873765,0.54828590,0.54783410,0.54738235,0.54693055,0.54647881,0.54602700,0.54557526,0.54512346,0.54467171,0.54421991,0.54376817,0.54331636,0.54286462,0.54241282,0.54196107,0.54150927,0.54105753,0.54060572,0.54015398,0.53970218,0.53925043,0.53879863,0.53834689,0.53789508,0.53744334,0.53699154,0.53653979,0.53608799,0.53563625,0.53518444,0.53473270,0.53428090,0.53382915,0.53337735,0.53292561,0.53247380,0.53202206,0.53157026,0.53111851,0.53066671,0.53021497,0.52976316,0.52931142,0.52885967,0.52840787,0.52795613,0.52750432,0.52705258,0.52660078,0.52614903,0.52569723,0.52524549,0.52479368,0.52434194,0.52389014,0.52343839,0.52298659,0.52253485,0.52208304,0.52163130,0.52117950,0.52072775,0.52027595,0.51982421,0.51937240,0.51892066,0.51846886,0.51801711,0.51756531,0.51711357,0.51666176,0.51621002,0.51575822,0.51530647,0.51485467,0.51440293,0.51395112,0.51349938,0.51304758,0.51259583,0.51214403,0.51169229,0.51124048,0.51078874,0.51033694,0.50988519,0.50943339,0.50898165,0.50852984,0.50807810,0.50762630,0.50717455,0.50672275,0.50627100,0.50581920,0.50536746,0.50491565,0.50446391,0.50401211,0.50356036,0.50310856,0.50265682,0.50220501,0.50175327,0.50130147,0.50084972,0.50039792,0.49994618,0.49949440,0.49904263,0.49859086,0.49813908,0.49768731,0.49723554,0.49678376,0.49633199,0.49588022,0.49542844,0.49497667,0.49452490,0.49407312,0.49362135,0.49316958,0.49271780,0.49226603,0.49181426,0.49136248,0.49091071,0.49045894,0.49000716,0.48955539,0.48910362,0.48865184,0.48820007,0.48774830,0.48729652,0.48684475,0.48639297,0.48594120,0.48548943,0.48503765,0.48458588,0.48413411,0.48368233,0.48323056,0.48277879,0.48232701,0.48187524,0.48142347,0.48097169,0.48051992,0.48006815,0.47961637,0.47916460,0.47871283,0.47826105,0.47780928,0.47735751,0.47690573,0.47645396,0.47600219,0.47555041,0.47509864,0.47464687,0.47419509,0.47374332,0.47329155,0.47283977,0.47238800,0.47193626,0.47148448,0.47103271,0.47058094,0.47012916,0.46967739,0.46922562,0.46877384,0.46832207,0.46787030,0.46741852,0.46696675,0.46651497,0.46606320,0.46561143,0.46515965,0.46470788,0.46425611,0.46380433,0.46335256,0.46290079,0.46244901,0.46199724,0.46154547,0.46109369,0.46064192,0.46019015,0.45973837,0.45928660,0.45883483,0.45838305,0.45793128,0.45747951,0.45702773,0.45657596,0.45612419,0.45567241,0.45522064,0.45476887,0.45431709,0.45386532,0.45341355,0.45296177,0.45251000,0.45205823,0.45160645,0.45115468,0.45070291,0.45025113,0.44979936,0.44934759,0.44889581,0.44844404,0.44799227,0.44754049,0.44708872,0.44663695,0.44618517,0.44573340,0.44528162,0.44482985,0.44437808,0.44392630,0.44347453,0.44302276,0.44257098,0.44211921,0.44166744,0.44121566,0.44076389,0.44031212,0.43986034,0.43940857,0.43895680,0.43850502,0.43805325,0.43760148,0.43714970,0.43669793,0.43624616,0.43579438,0.43534261,0.43489084,0.43443909,0.43398732,0.43353555,0.43308377,0.43263200,0.43218023,0.43172845,0.43127668,0.43082491,0.43037313,0.42992136,0.42946959,0.42901781,0.42856604,0.42811427,0.42766249,0.42721072,0.42675894,0.42630717,0.42585540,0.42540362,0.42495185,0.42450008,0.42404830,0.42359653,0.42314476,0.42269298,0.42224121,0.42178944,0.42133766,0.42088589,0.42043412,0.41998234,0.41953057,0.41907880,0.41862702,0.41817525,0.41772348,0.41727170,0.41681993,0.41636816,0.41591638,0.41546461,0.41501284,0.41456106,0.41410929,0.41365752,0.41320574,0.41275397,0.41230220,0.41185042,0.41139865,0.41094688,0.41049510,0.41004333,0.40959156,0.40913978,0.40868801,0.40823624,0.40778446,0.40733269,0.40688092,0.40642914,0.40597737,0.40552559,0.40507382,0.40462205,0.40417027,0.40371850,0.40326673,0.40281495,0.40236318,0.40191141,0.40145963,0.40100786,0.40055609,0.40010431,0.39965254,0.39920077,0.39874899,0.39829722,0.39784545,0.39739367,0.39694190,0.39649016,0.39603838,0.39558661,0.39513484,0.39468306,0.39423129,0.39377952,0.39332774,0.39287597,0.39242420,0.39197242,0.39152065,0.39106888,0.39061710,0.39016533,0.38971356,0.38926178,0.38881001,0.38835824,0.38790646,0.38745469,0.38700292,0.38655114,0.38609937,0.38564759,0.38519582,0.38474405,0.38429227,0.38384050,0.38338873,0.38293695,0.38248518,0.38203341,0.38158163,0.38112986,0.38067809,0.38022631,0.37977454,0.37932277,0.37887099,0.37841922,0.37796745,0.37751567,0.37706390,0.37661213,0.37616035,0.37570858,0.37525681,0.37480503,0.37435326,0.37390149,0.37344971,0.37299794,0.37254617,0.37209439,0.37164262,0.37119085,0.37073907,0.37028730,0.36983553,0.36938375,0.36893198,0.36848021,0.36802843,0.36757666,0.36712489,0.36667311,0.36622134,0.36576957,0.36531779,0.36486602,0.36441424,0.36396247,0.36351070,0.36305892,0.36260715,0.36215538,0.36170360,0.36125183,0.36080006,0.36034828,0.35989651,0.35944474,0.35899296,0.35854122,0.35808945,0.35763767,0.35718590,0.35673413,0.35628235,0.35583058,0.35537881,0.35492703,0.35447526,0.35402349,0.35357171,0.35311994,0.35266817,0.35221639,0.35176462,0.35131285,0.35086107,0.35040930,0.34995753,0.34950575,0.34905398,0.34860221,0.34815043,0.34769866,0.34724689,0.34679511,0.34634334,0.34589157,0.34543979,0.34498802,0.34453624,0.34408447,0.34363270,0.34318092,0.34272915,0.34227738,0.34182560,0.34137383,0.34092206,0.34047028,0.34001851,0.33956674,0.33911496,0.33866319,0.33821142,0.33775964,0.33730787,0.33685610,0.33640432,0.33595255,0.33550078,0.33504900,0.33459723,0.33414546,0.33369368,0.33324191,0.33279014,0.33233836,0.33188659,0.33143482,0.33098304,0.33053127,0.33007950,0.32962772,0.32917595,0.32872418,0.32827240,0.32782063,0.32736886,0.32691708,0.32646531,0.32601354,0.32556176,0.32510999,0.32465822,0.32420644,0.32375467,0.32330289,0.32285112,0.32239935,0.32194757,0.32149580,0.32104403,0.32059228,0.32014051,0.31968874,0.31923696,0.31878519,0.31833342,0.31788164,0.31742987,0.31697810,0.31652632,0.31607455,0.31562278,0.31517100,0.31471923,0.31426746,0.31381568,0.31336391,0.31291214,0.31246036,0.31200859,0.31155682,0.31110504,0.31065327,0.31020150,0.30974972,0.30929795,0.30884618,0.30839440,0.30794263,0.30749086,0.30703908,0.30658731,0.30613554,0.30568376,0.30523199,0.30478022,0.30432844,0.30387667,0.30342489,0.30297312,0.30252135,0.30206957,0.30161780,0.30116603,0.30071425,0.30026248,0.29981071,0.29935893,0.29890716,0.29845539,0.29800361,0.29755184,0.29710007,0.29664829,0.29619652,0.29574475,0.29529297,0.29484120,0.29438943,0.29393765,0.29348588,0.29303411,0.29258233,0.29213056,0.29167879,0.29122701,0.29077524,0.29032347,0.28987169,0.28941992,0.28896815,0.28851637,0.28806460,0.28761283,0.28716105,0.28670928,0.28625751,0.28580573,0.28535396,0.28490219,0.28445041,0.28399864,0.28354686,0.28309509,0.28264335,0.28219157,0.28173980,0.28128803,0.28083625,0.28038448,0.27993271,0.27948093,0.27902916,0.27857739,0.27812561,0.27767384,0.27722207,0.27677029,0.27631852,0.27586675,0.27541497,0.27496320,0.27451143,0.27405965,0.27360788,0.27315611,0.27270433,0.27225256,0.27180079,0.27134901,0.27089724,0.27044547,0.26999369,0.26954192,0.26909015,0.26863837,0.26818660,0.26773483,0.26728305,0.26683128,0.26637951,0.26592773,0.26547596,0.26502419,0.26457241,0.26412064,0.26366886,0.26321709,0.26276532,0.26231354,0.26186177,0.26141000,0.26095822,0.26050645,0.26005468,0.25960290,0.25915113,0.25869936,0.25824758,0.25779581,0.25734404,0.25689226,0.25644049,0.25598872,0.25553694,0.25508517,0.25463340,0.25418162,0.25372985,0.25327808,0.25282630,0.25237453,0.25192276,0.25147098,0.25101921,0.25056744,0.25011566,0.24966390,0.24921213,0.24876036,0.24830858,0.24785681,0.24740504,0.24695326,0.24650149,0.24604972,0.24559794,0.24514617,0.24469440,0.24424262,0.24379085,0.24333908,0.24288730,0.24243553,0.24198376,0.24153198,0.24108021,0.24062844,0.24017666,0.23972489,0.23927312,0.23882134,0.23836957,0.23791780,0.23746602,0.23701425,0.23656248,0.23611070,0.23565893,0.23520717,0.23475540,0.23430362,0.23385185,0.23340008,0.23294830,0.23249653,0.23204476,0.23159298,0.23114121,0.23068944,0.23023766,0.22978589,0.22933412,0.22888234,0.22843057,0.22797880,0.22752702,0.22707525,0.22662348,0.22617170,0.22571993,0.22526816,0.22481638,0.22436461,0.22391284,0.22346106,0.22300929,0.22255751,0.22210574,0.22165397,0.22120219,0.22075042,0.22029865,0.21984687,0.21939510,0.21894333,0.21849155,0.21803978,0.21758801,0.21713623,0.21668446,0.21623270,0.21578093,0.21532916,0.21487738,0.21442561,0.21397384,0.21352206,0.21307029,0.21261851,0.21216674,0.21171497,0.21126319,0.21081142,0.21035965,0.20990787,0.20945610,0.20900433,0.20855255,0.20810078,0.20764901,0.20719723,0.20674546,0.20629369,0.20584191,0.20539014,0.20493837,0.20448659,0.20403482,0.20358305,0.20313127,0.20267950,0.20222773,0.20177595,0.20132418,0.20087241,0.20042063,0.19996886,0.19951709,0.19906531,0.19861354,0.19816177,0.19771001,0.19725823,0.19680646,0.19635469,0.19590291,0.19545114,0.19499937,0.19454759,0.19409582,0.19364405,0.19319227,0.19274050,0.19228873,0.19183695,0.19138518,0.19093341,0.19048163,0.19002986,0.18957809,0.18912631,0.18867454,0.18822277,0.18777099,0.18731922,0.18686745,0.18641567,0.18596390,0.18551213,0.18506035,0.18460858,0.18415681,0.18370503,0.18325326,0.18280149,0.18234971,0.18189794,0.18144616,0.18099439,0.18054262,0.18009084,0.17963907,0.17918730,0.17873554,0.17859288,0.17858270,0.17857252,0.17856236,0.17855218,0.17854200,0.17853183,0.17852165,0.17851147,0.17850131,0.17849113,0.17848095,0.17847078,0.17846060};

	typedef enum {CHORD_E, CHORD_G, CHORD_D, CHORD_A, CHORD_C, CHORD_F} CHORD_TYPE;

	float (*p[6])() = {chord_e_func, chord_g_func, chord_d_func, chord_a_func, chord_c_func, chord_f_func};

	typedef struct melody
	{
		CHORD_TYPE chord;
		uint8 duration;
	}MELODY;

	MELODY melody1 [42] = {{CHORD_C,1}, {CHORD_C,1}, {CHORD_G,1}, {CHORD_G,1}, {CHORD_A,1}, {CHORD_A,1}, {CHORD_G,2},
			   {CHORD_F,1}, {CHORD_F,1}, {CHORD_E,1}, {CHORD_E,1}, {CHORD_D,1}, {CHORD_D,1}, {CHORD_C,2},
			   {CHORD_G,1}, {CHORD_G,1}, {CHORD_F,1}, {CHORD_F,1}, {CHORD_E,1}, {CHORD_E,1}, {CHORD_D,2},
			   {CHORD_G,1}, {CHORD_G,1}, {CHORD_F,1}, {CHORD_F,1}, {CHORD_E,1}, {CHORD_E,1}, {CHORD_D,2},
			   {CHORD_C,1}, {CHORD_C,1}, {CHORD_G,1}, {CHORD_G,1}, {CHORD_A,1}, {CHORD_A,1}, {CHORD_G,2},
			   {CHORD_F,1}, {CHORD_F,1}, {CHORD_E,1}, {CHORD_E,1}, {CHORD_D,1}, {CHORD_D,1}, {CHORD_C,2}};;


		for(;;)
		{
			if(1 == FLEX_get_done())
			{
				switch(melody1[counter].duration)
				{
				case 1:
					FLEX_on_0_5();
					chord_number = melody1[counter].chord;
					counter++;
					break;
				case 2:
					FLEX_on_1();
					chord_number = melody1[counter].chord;
					counter++;
					break;
				}
			}
			t = FLEX_get_time();
			sin_val = (*p[chord_number])();
			DAC0_newValue((uint16)(sin_val * env[(int)(t/0.001f)]));
		}

	return 0;
}

float chord_e_func()
{
	//chord_e
	return sin(164.8*2*M_PI*t) + (1/2)*sin(329.6*2*M_PI*t) + (1/3)*sin(493.9*2*M_PI*t) + (1/4)*sin(659.3*2*M_PI*t) + (1/5)*sin(784*2*M_PI*t) + (2/5)*sin(784*2*M_PI*t);
}
float chord_g_func()
{
	//chord_g =
	return sin(196*2*M_PI*t) + (1/2)*sin(392*2*M_PI*t) + (1/3)*sin(587.3*2*M_PI*t) + (1/4)*sin(784*2*M_PI*t) + (1/5)*sin(987.8*2*M_PI*t) + (2/5)*sin(987.8*2*M_PI*t);
}
float chord_d_func()
{
	//chord_d =
	return sin(146.8*2*M_PI*t) + (1/2)*sin(293.7*2*M_PI*t) + (1/3)*sin(440*2*M_PI*t) + (1/4)*sin(587.3*2*M_PI*t) + (1/5)*sin(698.5*2*M_PI*t) + (2/5)*sin(698.5*2*M_PI*t);
}
float chord_a_func()
{
	//chord_a =
	return sin(220*2*M_PI*t) + (1/2)*sin(440*2*M_PI*t) + (1/3)*sin(659.3*2*M_PI*t) + (1/4)*sin(880*2*M_PI*t) + (1/5)*sin(1046.5*2*M_PI*t) + (2/5)*sin(1046.5*2*M_PI*t);
}
float chord_c_func()
{
	//chord_c =
	return sin(130.8*2*M_PI*t) + (1/2)*sin(261.6*2*M_PI*t) + (1/3)*sin(392*2*M_PI*t) + (1/4)*sin(523.3*2*M_PI*t) + (1/5)*sin(659.3*2*M_PI*t) + (2/5)*sin(659.3*2*M_PI*t);
}
float chord_f_func()
{
	//chord_f =
	return sin(174.6*2*M_PI*t) + (1/2)*sin(349.2*2*M_PI*t) + (1/3)*sin(523.3*2*M_PI*t) + (1/4)*sin(698.5*2*M_PI*t) + (1/5)*sin(880*2*M_PI*t) + (2/5)*sin(880*2*M_PI*t);
}

